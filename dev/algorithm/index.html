<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The algorithm · QuaternionIntegrator.jl</title><link href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.2.0/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/documenter.css" rel="stylesheet" type="text/css"/></head><body><nav class="toc"><h1>QuaternionIntegrator.jl</h1><select id="version-selector" onChange="window.location.href=this.value" style="visibility: hidden"></select><form class="search" id="search-form" action="../search/"><input id="search-query" name="q" type="text" placeholder="Search docs"/></form><ul><li><a class="toctext" href="../">QuaternionIntegrator</a></li><li class="current"><a class="toctext" href>The algorithm</a><ul class="internal"><li><a class="toctext" href="#Orientation-and-coordinate-frames-1">Orientation and coordinate frames</a></li><li><a class="toctext" href="#Integration-step-1">Integration step</a></li></ul></li><li><a class="toctext" href="../interface/">API</a></li></ul></nav><article id="docs"><header><nav><ul><li><a href>The algorithm</a></li></ul><a class="edit-page" href="https://github.com/dronir/QuaternionIntegrator.jl/blob/master/docs/src/algorithm.md"><span class="fa"></span> Edit on GitHub</a></nav><hr/><div id="topbar"><span>The algorithm</span><a class="fa fa-bars" href="#"></a></div></header><h1><a class="nav-anchor" id="The-algorithm-1" href="#The-algorithm-1">The algorithm</a></h1><p>The purpose of the algorithm is to take the current orientation <span>$q_0$</span> and angular velocity <span>$\omega_0$</span> and produce the orientation <span>$q_1$</span> and angular velocity <span>$\omega_1$</span> after a time step <span>$\Delta t$</span>.</p><h2><a class="nav-anchor" id="Orientation-and-coordinate-frames-1" href="#Orientation-and-coordinate-frames-1">Orientation and coordinate frames</a></h2><p>An object&#39;s orientation is a rotation between two coordinate frames: world coordinates and body coordinates. The body frame is fixed to the object and rotates with it relative to the world coordinates.</p><p>The orientation of the object is represented as a standard rotation quaternion: given a unit vector along a rotational axis <span>$\mathbf v$</span> and an angle around that axis <span>$\theta$</span>, the quaternion is</p><div>\[q = \left(\cos \frac{\theta}{2}, \sin \frac{\theta}{2} \mathbf v \right).\]</div><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>Quaternions are represented in this text as a pair <span>$(a, \mathbf v)$</span> of a real number and a 3-dimensional real-valued vector. Other equivalent representations exist but this one is the most useful here.</p></div></div><p>The orientation quaternion is used to transform vectors from body coordinates to world coordinates and vice versa. Given a vector <span>$\mathbf v_b$</span> in body coordinates, and the orientation <span>$q$</span>, the rotation to world coordinates coordinates is the operation <span>$\mathbf v = q \mathbf v_b q^{-1}$</span>. The rotation from world coordinates to body coordinates is simply the inverse, <span>$\mathbf v_b = q^{-1} \mathbf v q$</span>.</p><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>We denote the rotation of a vector <span>$\mathbf v$</span> by a quaternion with <span>$q \mathbf v q^{-1}$</span>. In practice, this operation involves constructing a new quaternion <span>$(0, \mathbf v)$</span>, performing the quaternion multiplication and extracting the vector part of the resulting quaternion.</p></div></div><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>We denote vectors in the body coordinate frame with the subscript <code>b</code> and in the world coordinate with no subsript.</p></div></div><h2><a class="nav-anchor" id="Integration-step-1" href="#Integration-step-1">Integration step</a></h2><p>The algorithm is from F. Zhao and B. G. M. van Wachem (2013) <em>A novel Quaternion integration approach for describing the behaviour of non-spherical particles</em>, Acta Mech 224, 3091–3109. For a full derivation and more detail, see the paper.</p><p>We begin with the initial orientation <span>$q_0$</span>, initial angular velocity vector <span>$\mathbf \omega_0$</span>, which is the momentary rate of change of the orientation. We also have a torque function <span>$T(q)$</span> which taken an orientation quaternion and returns a torque vector in world coordinates, as well as the inertial tensor of the object, given in the body frame, <span>$I_b$</span>.</p><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>We denote quantities at the beginning of the timestep with the subscript 0, at the end of the timestep with subscript 1. In the algorithm, also midpoint and quarter-point values are used and these are denoted with <span>$\frac{1}{2}$</span> and <span>$\frac{1}{4}$</span></p></div></div><p>First we transform the angular velocity vector to body coordinates:</p><div>\[\mathbf \omega_{b,0} = q_0^{-1} \mathbf \omega_0 q.\]</div><p>We compute the torque in the initial orientation and transform the resulting torque vector to the body frame.</p><div>\[\tau_0 = T(q_0),\]</div><div>\[\tau_{b,0} = q_0^{-1} \mathbf \tau_0 q.\]</div><p>The angular acceleration, in the body frame, is computed from the inertia and the torque:</p><div>\[\dot\omega_{b,0} = I_b^{-1} \left( \tau_{b,0} - \omega_{b,0} \times I_b \omega_{b,0} \right)\]</div><p>Next, we compute angular velocity in the body frame after a quarter timestep and a half timestep.</p><div>\[\omega_{b,\frac{1}{4}} = \omega_{b,o} + \frac{1}{2} \dot\omega_{b,0} \Delta t\]</div><div>\[\omega_{b,\frac{1}{2}} = \omega_{b,0} + \frac{1}{4} \dot\omega_{b,0} \Delta t\]</div><p>We rotate the quarter-point angular velocity to the world coordinates and use it to compute a &quot;prediction&quot; for the half-point orientation quaternion.</p><div>\[\omega_\frac{1}{4} = q_0 \omega_{b,\frac{1}{4}} q_0^{-1}\]</div><div>\[q_\frac{1}{2} = \left( \cos \left(\frac{1}{4} \left| \omega_\frac{1}{4} \right|
\Delta t \right), \sin \left( \frac{1}{4} \left| \omega_\frac{1}{4} \right| \Delta t
\right) \hat \omega_\frac{1}{4} \right) q_0\]</div><div class="admonition note"><div class="admonition-title">Note</div><div class="admonition-text"><p>The hat represents a vector normalized to unit length.</p></div></div><p>This predicted midpoint orientation is then used to compute a torque and angular acceleration at the midpoint:</p><div>\[\tau_0 = T(q_\frac{1}{2}),\]</div><div>\[\tau_{b,\frac{1}{2}} = q_0^{-1} \mathbf \tau_\frac{1}{2} q.\]</div><div>\[\dot\omega_{b,\frac{1}{2}} = I_b^{-1} \left( \tau_{b,\frac{1}{2}} - \omega_{b,\frac{1}{2}} \times I_b \omega_{b,\frac{1}{2}} \right)\]</div><p>This midpoint acceleration is then used with the starting orientation to compute the endpoint orientation</p><div>\[\omega_\frac{1}{2} = q_\frac{1}{2} \omega_{b,\frac{1}{2}} q_\frac{1}{2}^{-1}\]</div><div>\[q_1 = \left( \cos \left(\frac{1}{2} \left| \omega_\frac{1}{2} \right|
\Delta t \right), \sin \left( \frac{1}{2} \left| \omega_\frac{1}{2} \right| \Delta t
\right) \hat \omega_\frac{1}{2} \right) q_0\]</div><p>Finally, the angular acceleration at the midpoint is used to compute the angular velocity at the endpoint.</p><div>\[\omega_{b,1} = \omega_{b,0} + \dot\omega_{b,\frac{1}{2}} \Delta t\]</div><div>\[\omega_1 = q_1 \omega_{b,1} q_1^{-1}\]</div><footer><hr/><a class="previous" href="../"><span class="direction">Previous</span><span class="title">QuaternionIntegrator</span></a><a class="next" href="../interface/"><span class="direction">Next</span><span class="title">API</span></a></footer></article></body></html>
